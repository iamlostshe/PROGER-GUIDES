#### **Содержание:**

- **[[#Анализ]]**
- **[[#О запросах в requests.]]**
- **[[#Пакет JSON]]**
- **[[#Заключение]]**

Wildberries идеально подходит для обучения парсингу, потому что у него нет никаких блокировок для ботов.

Разберем пошагово что стоит делать, чтобы получить необходимые нам данные.

#### **Анализ**

Главный инструмент для анализа - вкладка "Сеть" инструментов разработчика в браузере.

Чтобы их открыть нажимаем "F12" или "ПКМ" + "Просмотреть код", затем выбираем вкладку "Сеть" и обновляем страницу.

![[Pasted image 20240812213929.png]]

Видим множество подгружающихся файлов. Разберем несколько аспектов:

- Стоит сразу выбрать фильтры в зависимости от того, что вам нужно. Для парсинга данных о товаре (на wb подгружаются из json) нам стоит выбрать фильтр "Fetch/XHR".

- static (на wb указано в url) - файлы одинаковые для всех страниц, например, общий CSS, HTML. Статичные файлы нас не интересуют.

Больше нам ничего не остается, кроме как идти по порядку сверху вниз и смотреть во вкладке "Предварительный просмотр" какие данные они в себе содержат.

![[Pasted image 20240812214653.png]]

Экспериментальным образом удалось выявить, что в файле "card.json" содержится базовая информация о товаре. Выписываем URL запроса и анализируем его:

``` markdown
https://basket-12.wbbasket.ru/vol1772/part177243/177243989/info/ru/card.json
```

- "basket-XX" - выделенный сегмент сервера, на котором лежат нужные нам данные. Обращу внимание на этот момент, на wb встречаются следующие basket-ы:

``` python
basket = ['11', '10', '12', '13', '06', '07', '08', '02', '05']
```

- **"1772"** - первые четыре цифры артикула товара.
- **"177243"** - первые шесть цифр артикула товара.
- **"177243989"** - артикул товара полностью.
- **".json"** - данные будут в формате JSON.

Но почему в данных нет цены? Вопрос достаточно интересный, возможно, wb просто не хотели, чтобы ботам было настолько просто парсить (но тогда проще было поставить защиту от ботов, как у конкурентов). А может быть это сделано ради тонкой настройки валюты. Правду мы никогда не узнаем...

Цена находится в другом запросе (также найден путем перебора запросов):

```
https://card.wb.ru/cards/detail?curr=rub&dest=123585916&nm=224647909
```

- "curr=rub" - валюта, в которой будет дан ответ (также доступны: usd, byn, kzt, amd, kgs, uzs).
- "dest=XXXXXXXXX" - что-то вроде токена, ваш идентификатор, без которого ничего не работает.
- "nm=XXXXXXXX" - уникальный идентификатор товара, для получения данных о нем (можно получить из данных о продавце ()).

#### **О запросах в requests**

Для использования пакета его необходимо установить:

``` python
pip install requests
```

Затем создаем файл и импортируем туда requests:

``` python
import requests
```

Запросы осуществляются так:

``` python
r_get = requests.get('https://example.com')
r_post = requests.post('https://example.com')
r_options = requests.options('https://example.com')
```

Обратим внимание, на то, какой тип запроса осуществляет сервер: POST, GET или другой. WB использует GET запросы.

Рассмотрим несколько аспектов, которые пригодятся в будущем:

``` python
print(r_get.text) # Вывод содержимого страницы
print(r_get.status_code) # Вывод кода-ответа сервера
```

Переберём все возможные basket-ы, пока не найдем подходящий и не получим статус "200" (в зависимости от basket-а ссылка немного меняется, на это тоже следует обращать внимание).

``` python
basket = ['11', '10', '12', '13', '06', '07', '08', '02', '05']

for i in basket:
  if i in [7, 8]:
    img_url = f'https://basket-{i}.wbbasket.ru/vol{art[:3]}/part...'
  else:
    img_url = f'https://basket-{i}.wbbasket.ru/vol{art[:4]}/part...'

  if requests.get(img_url).status_code == 200:
    basket = i
```

#### [ИСХОДНЫЙ КОД В НАШЕМ ТЕЛЕГРАМ КАНАЛЕ](https://t.me/masterskaya_AI/153)

Получаем данные в формате json, которые теперь нужно преобразовать в человеческий вид.

#### **Пакет JSON**

Json встроен в python, поэтому его не нужно устанавливать.

Импортируем json в наш файл:

``` python
import json
```

Загружаем полученные ранее данные:

``` python
data = json.loads(response.text)
```

Теперь мы можем обращаться к его элементам так:

``` python
title = data['data']['products'][0]['name']
print(title)

>>> Футболка оверсайз для подростка с принтом
```

#### [ИСХОДНЫЙ КОД В НАШЕМ ТЕЛЕГРАМ КАНАЛЕ](https://t.me/masterskaya_AI)

#### **Заключение**

Таким образом мы получаем данные о названии, цене, зачеркнутой цене, ссылке на картинку:

![[Pasted image 20240812214424.png]]